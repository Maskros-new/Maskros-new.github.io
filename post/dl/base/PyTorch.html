<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Sans SC:300,300italic,400,400italic,700,700italic|Noto Serif SC:300,300italic,400,400italic,700,700italic|Fira Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"maskros.top","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"default"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="ref: PyTorchæ–‡æ¡£  PyTorch æ˜¯æ˜¯åŸºäºä»¥ä¸‹ä¸¤ä¸ªç›®çš„è€Œæ‰“é€ çš„pythonç§‘å­¦è®¡ç®—æ¡†æ¶ï¼š  æ— ç¼æ›¿æ¢NumPyï¼Œåˆ©ç”¨GPUçš„ç®—åŠ›æ¥åŠ é€Ÿç¥ç»ç½‘ç»œ é€šè¿‡è‡ªåŠ¨å¾®åˆ†æœºåˆ¶ï¼Œæ¥è®©ç¥ç»ç½‘ç»œçš„å®ç°å˜å¾—æ›´åŠ å®¹æ˜“">
<meta property="og:type" content="article">
<meta property="og:title" content="PyTorchåŸºç¡€">
<meta property="og:url" content="https://maskros.top/post/dl/base/PyTorch.html">
<meta property="og:site_name" content="Maskros&#39; Blog">
<meta property="og:description" content="ref: PyTorchæ–‡æ¡£  PyTorch æ˜¯æ˜¯åŸºäºä»¥ä¸‹ä¸¤ä¸ªç›®çš„è€Œæ‰“é€ çš„pythonç§‘å­¦è®¡ç®—æ¡†æ¶ï¼š  æ— ç¼æ›¿æ¢NumPyï¼Œåˆ©ç”¨GPUçš„ç®—åŠ›æ¥åŠ é€Ÿç¥ç»ç½‘ç»œ é€šè¿‡è‡ªåŠ¨å¾®åˆ†æœºåˆ¶ï¼Œæ¥è®©ç¥ç»ç½‘ç»œçš„å®ç°å˜å¾—æ›´åŠ å®¹æ˜“">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-09-10T15:00:00.000Z">
<meta property="article:modified_time" content="2022-09-25T05:23:18.904Z">
<meta property="article:author" content="Maskros">
<meta property="article:tag" content="note">
<meta property="article:tag" content="æ·±åº¦å­¦ä¹ ">
<meta property="article:tag" content="python">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://maskros.top/post/dl/base/PyTorch.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>PyTorchåŸºç¡€ | Maskros' Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/atom.xml" title="Maskros' Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Maskros' Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://maskros.top/post/dl/base/PyTorch.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo_Maskros.jpg">
      <meta itemprop="name" content="Maskros">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Maskros' Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          PyTorchåŸºç¡€
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2022-09-10 23:00:00" itemprop="dateCreated datePublished" datetime="2022-09-10T23:00:00+08:00">2022-09-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-09-25 13:23:18" itemprop="dateModified" datetime="2022-09-25T13:23:18+08:00">2022-09-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NOTE/" itemprop="url" rel="index"><span itemprop="name">NOTE</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/post/dl/base/PyTorch.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/post/dl/base/PyTorch.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <link rel="stylesheet" type="text&#x2F;css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><blockquote>
<p>ref: <a href="pytorch.apachecn.org">PyTorchæ–‡æ¡£</a></p>
</blockquote>
<p>PyTorch æ˜¯æ˜¯åŸºäºä»¥ä¸‹ä¸¤ä¸ªç›®çš„è€Œæ‰“é€ çš„pythonç§‘å­¦è®¡ç®—æ¡†æ¶ï¼š</p>
<ul>
<li>æ— ç¼æ›¿æ¢NumPyï¼Œåˆ©ç”¨GPUçš„ç®—åŠ›æ¥åŠ é€Ÿç¥ç»ç½‘ç»œ</li>
<li>é€šè¿‡è‡ªåŠ¨å¾®åˆ†æœºåˆ¶ï¼Œæ¥è®©ç¥ç»ç½‘ç»œçš„å®ç°å˜å¾—æ›´åŠ å®¹æ˜“</li>
</ul>
<span id="more"></span>
<h2 id="åŸºç¡€çŸ¥è¯†">åŸºç¡€çŸ¥è¯†</h2>
<h3 id="å¼ é‡">å¼ é‡</h3>
<p>tensor</p>
<h4 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h4>
<ol>
<li>
<p><strong>ç›´æ¥ç”Ÿæˆå¼ é‡</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
x_data <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li>
<p><strong>é€šè¿‡numpyæ•°ç»„ç”Ÿæˆ</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">np_array <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
x_np <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>np_array<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li>
<p><strong>é€šè¿‡å·²æœ‰çš„å¼ é‡æ¥ç”Ÿæˆæ–°çš„å¼ é‡</strong></p>
<p>ç»§æ‰¿å·²æœ‰å¼ é‡çš„æ•°æ®å±æ€§ï¼ˆç»“æ„ã€ç±»å‹ï¼‰ï¼Œä¹Ÿå¯ä»¥é‡å†™æ–°ç±»å‹</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">x_ones <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>x_data<span class="token punctuation">)</span>   <span class="token comment"># ä¿ç•™ x_data çš„å±æ€§</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Ones Tensor: \n </span><span class="token interpolation"><span class="token punctuation">{</span>x_ones<span class="token punctuation">}</span></span><span class="token string"> \n"</span></span><span class="token punctuation">)</span>

x_rand <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand_like<span class="token punctuation">(</span>x_data<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">)</span>   <span class="token comment"># é‡å†™ x_data çš„æ•°æ®ç±»å‹</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Random Tensor: \n </span><span class="token interpolation"><span class="token punctuation">{</span>x_rand<span class="token punctuation">}</span></span><span class="token string"> \n"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>
<p><strong>é€šè¿‡æŒ‡å®šæ•°æ®ç»´åº¦æ¥ç”Ÿæˆå¼ é‡</strong></p>
<p><code>shape</code>æ˜¯å…ƒç»„ç±»å‹, ç”¨æ¥æè¿°å¼ é‡çš„ç»´æ•°, ä¸‹é¢3ä¸ªå‡½æ•°é€šè¿‡ä¼ å…¥<code>shape</code>æ¥æŒ‡å®šç”Ÿæˆå¼ é‡çš„ç»´æ•°ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">shape <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
rand_tensor <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span>shape<span class="token punctuation">)</span>
ones_tensor <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span>shape<span class="token punctuation">)</span>
zeros_tensor <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>shape<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Random Tensor: \n </span><span class="token interpolation"><span class="token punctuation">{</span>rand_tensor<span class="token punctuation">}</span></span><span class="token string"> \n"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Ones Tensor: \n </span><span class="token interpolation"><span class="token punctuation">{</span>ones_tensor<span class="token punctuation">}</span></span><span class="token string"> \n"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Zeros Tensor: \n </span><span class="token interpolation"><span class="token punctuation">{</span>zeros_tensor<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
<h4 id="å±æ€§">å±æ€§</h4>
<p>ç»´æ•°<code>shape</code>ã€æ•°æ®ç±»å‹<code>dtype</code>ä»¥åŠå®ƒä»¬æ‰€å­˜å‚¨çš„è®¾å¤‡(CPUæˆ–GPU)<code>device</code></p>
<h4 id="è¿ç®—">è¿ç®—</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># åˆ¤æ–­å½“å‰ç¯å¢ƒGPUæ˜¯å¦å¯ç”¨, ç„¶åå°†tensorå¯¼å…¥GPUå†…è¿è¡Œ</span>
<span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  tensor <span class="token operator">=</span> tensor<span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">'cuda'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>ç´¢å¼•å’Œåˆ‡ç‰‡</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">tensor <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
tensor<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>            <span class="token comment"># å°†ç¬¬1åˆ—(ä»0å¼€å§‹)çš„æ•°æ®å…¨éƒ¨èµ‹å€¼ä¸º0</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>tensor<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>æ‹¼æ¥</strong></p>
<p><code>torch.cat</code> æˆ– <code>torch.stack</code>ï¼Œdimä¸ºæ‹¼æ¥æ–¹å‘çš„ç»´åº¦</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">t1 <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>tensor<span class="token punctuation">,</span> tensor<span class="token punctuation">,</span> tensor<span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>å¼ é‡ä¹˜ç§¯å’ŒçŸ©é˜µä¹˜æ³•</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># é€ä¸ªç›¸ä¹˜ï¼ŒäºŒè€…ç­‰ä»·</span>
tensor<span class="token punctuation">.</span>mul<span class="token punctuation">(</span>tensor<span class="token punctuation">)</span>
tensor <span class="token operator">*</span> tensor

<span class="token comment"># çŸ©é˜µä¹˜æ³•</span>
tensor<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>tensor<span class="token punctuation">.</span>T<span class="token punctuation">)</span>
tensor @ tensor<span class="token punctuation">.</span>T<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>è‡ªåŠ¨èµ‹å€¼è¿ç®—</strong></p>
<p>è‡ªåŠ¨èµ‹å€¼è¿ç®—é€šå¸¸åœ¨æ–¹æ³•åæœ‰ <code>_</code> ä½œä¸ºåç¼€ï¼Œä¾‹å¦‚: <code>x.copy_(y)</code>, <code>x.t_()</code>æ“ä½œä¼šæ”¹å˜ <code>x</code> çš„å–å€¼ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">tensor<span class="token punctuation">.</span>add_<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>è‡ªåŠ¨èµ‹å€¼è¿ç®—è™½ç„¶å¯ä»¥èŠ‚çœå†…å­˜, ä½†åœ¨æ±‚å¯¼æ—¶ä¼šå› ä¸ºä¸¢å¤±äº†ä¸­é—´è¿‡ç¨‹è€Œå¯¼è‡´ä¸€äº›é—®é¢˜, æ‰€ä»¥æˆ‘ä»¬å¹¶ä¸é¼“åŠ±ä½¿ç”¨å®ƒã€‚</p>
</blockquote>
<h3 id="autograd">Autograd</h3>
<p><code>torch.autograd</code>æ˜¯ PyTorch çš„è‡ªåŠ¨å·®åˆ†å¼•æ“ï¼Œå¯ä¸ºç¥ç»ç½‘ç»œè®­ç»ƒæä¾›æ”¯æŒã€‚</p>
<p>exï¼šä¸€ä¸ªè®­ç»ƒæ­¥éª¤ç¤ºä¾‹</p>
<p>ä»<code>torchvision</code>åŠ è½½äº†ç»è¿‡é¢„è®­ç»ƒçš„ resnet18 æ¨¡å‹ã€‚ æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªéšæœºæ•°æ®å¼ é‡æ¥è¡¨ç¤ºå…·æœ‰ 3 ä¸ªé€šé“çš„å•ä¸ªå›¾åƒï¼Œé«˜åº¦&amp;å®½åº¦ä¸º 64ï¼Œå…¶å¯¹åº”çš„<code>label</code>åˆå§‹åŒ–ä¸ºä¸€äº›éšæœºå€¼ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token punctuation">,</span> torchvision
model <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>models<span class="token punctuation">.</span>resnet18<span class="token punctuation">(</span>pretrained<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>
labels <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ­£å‘ä¼ æ’­ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">prediction <span class="token operator">=</span> model<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment"># forward pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>åå‘ä¼ æ’­ï¼ŒAutograd ä¼šä¸ºæ¯ä¸ªæ¨¡å‹å‚æ•°è®¡ç®—æ¢¯åº¦å¹¶å°†å…¶å­˜å‚¨åœ¨å‚æ•°çš„<code>.grad</code>å±æ€§ä¸­ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">loss <span class="token operator">=</span> <span class="token punctuation">(</span>prediction <span class="token operator">-</span> labels<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># backward pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åŠ è½½ä¸€ä¸ªä¼˜åŒ–å™¨ï¼Œåœ¨æœ¬ä¾‹ä¸­ä¸º SGDï¼Œå­¦ä¹ ç‡ä¸º 0.01ï¼ŒåŠ¨é‡ä¸º 0.9ã€‚ æˆ‘ä»¬åœ¨ä¼˜åŒ–å™¨ä¸­æ³¨å†Œæ¨¡å‹çš„æ‰€æœ‰å‚æ•°ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">optim <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è°ƒç”¨<code>.step()</code>å¯åŠ¨æ¢¯åº¦ä¸‹é™ã€‚ ä¼˜åŒ–å™¨é€šè¿‡<code>.grad</code>ä¸­å­˜å‚¨çš„æ¢¯åº¦æ¥è°ƒæ•´æ¯ä¸ªå‚æ•°ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">optim<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#gradient descent</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="autogradçš„å¾®åˆ†">Autogradçš„å¾®åˆ†</h4>
<p>exï¼š<code>autograd</code>å¦‚ä½•æ”¶é›†æ¢¯åº¦ã€‚é¦–å…ˆç”¨<code>requires_grad=True</code>åˆ›å»ºä¸¤ä¸ªå¼ é‡<code>a</code>å’Œ<code>b</code>ã€‚ è¿™å‘<code>autograd</code>å‘å‡ºä¿¡å·ï¼Œåº”è·Ÿè¸ªå¯¹å®ƒä»¬çš„æ‰€æœ‰æ“ä½œã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>ä»<code>a</code>å’Œ<code>b</code>åˆ›å»ºå¦ä¸€ä¸ªå¼ é‡<code>Q</code>ã€‚å‡è®¾<code>a</code>å’Œ<code>b</code>æ˜¯å‚æ•°ï¼Œ<code>Q</code>æ˜¯è¯¯å·®ï¼Œåœ¨<code>Q</code>ä¸Šè°ƒç”¨<code>.backward()</code>æ—¶ï¼ŒAutograd å°†è®¡ç®—è¿™äº›æ¢¯åº¦å¹¶å°†å…¶å­˜å‚¨åœ¨å„ä¸ªå¼ é‡çš„<code>.grad</code>å±æ€§ä¸­ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦åœ¨<code>Q.backward()</code>ä¸­æ˜¾å¼ä¼ é€’<code>gradient</code>å‚æ•°ï¼Œå› ä¸ºå®ƒæ˜¯å‘é‡ã€‚ <code>gradient</code>æ˜¯ä¸<code>Q</code>å½¢çŠ¶ç›¸åŒçš„å¼ é‡ï¼Œå®ƒè¡¨ç¤º<code>Q</code>ç›¸å¯¹äºæœ¬èº«çš„æ¢¯åº¦ï¼Œå³ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.452ex" xmlns="http://www.w3.org/2000/svg" width="1.357ex" height="2.149ex" role="img" focusable="false" viewbox="0 -750 600 950"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mn"><text data-variant="double-struck" transform="scale(1,-1)" font-size="884px">ğŸ™</text></g></g></g></g></svg></mjx-container> ï¼›åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†<code>Q</code>èšåˆä¸ºä¸€ä¸ªæ ‡é‡ï¼Œç„¶åéšå¼åœ°å‘åè°ƒç”¨ï¼Œä¾‹å¦‚<code>Q.sum().backward()</code>ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">Q <span class="token operator">=</span> <span class="token number">3</span><span class="token operator">*</span>a<span class="token operator">**</span><span class="token number">3</span> <span class="token operator">-</span> b<span class="token operator">**</span><span class="token number">2</span>
external_grad <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Q<span class="token punctuation">.</span>backward<span class="token punctuation">(</span>gradient<span class="token operator">=</span>external_grad<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>æ£€æŸ¥æ²‰ç§¯çš„æ¢¯åº¦ï¼Œæ— è¯¯ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># ç»“æœéƒ½æ˜¯true</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token operator">*</span>a<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">==</span> a<span class="token punctuation">.</span>grad<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">*</span>b <span class="token operator">==</span> b<span class="token punctuation">.</span>grad<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="è®¡ç®—å›¾">è®¡ç®—å›¾</h4>
<p>Autograd åœ¨ç”±å‡½æ•°å¯¹è±¡ç»„æˆçš„æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ä¸­è®°å½•æ•°æ®ï¼ˆå¼ é‡ï¼‰å’Œæ‰€æœ‰å·²æ‰§è¡Œçš„æ“ä½œï¼ˆä»¥åŠç”±æ­¤äº§ç”Ÿçš„æ–°å¼ é‡ï¼‰ã€‚ åœ¨æ­¤ DAG ä¸­ï¼Œå¶å­æ˜¯è¾“å…¥å¼ é‡ï¼Œæ ¹æ˜¯è¾“å‡ºå¼ é‡ã€‚ é€šè¿‡ä»æ ¹åˆ°å¶è·Ÿè¸ªæ­¤å›¾ï¼Œå¯ä»¥ä½¿ç”¨é“¾å¼è§„åˆ™è‡ªåŠ¨è®¡ç®—æ¢¯åº¦ã€‚</p>
<p>åœ¨æ­£å‘ä¼ æ’­ä¸­ï¼ŒAutograd åŒæ—¶æ‰§è¡Œä¸¤é¡¹æ“ä½œï¼š</p>
<ul>
<li>è¿è¡Œè¯·æ±‚çš„æ“ä½œä»¥è®¡ç®—ç»“æœå¼ é‡</li>
<li>åœ¨ DAG ä¸­ç»´æŠ¤æ“ä½œçš„æ¢¯åº¦å‡½æ•°</li>
</ul>
<p>å½“åœ¨ DAG æ ¹ç›®å½•ä¸Šè°ƒç”¨<code>.backward()</code>æ—¶ï¼Œåå‘ä¼ é€’å¼€å§‹ã€‚ Autogradæ‰§è¡Œï¼š</p>
<ul>
<li>ä»æ¯ä¸ª<code>.grad_fn</code>è®¡ç®—æ¢¯åº¦ï¼Œå°†å®ƒä»¬ç´¯ç§¯åœ¨å„è‡ªçš„å¼ é‡çš„<code>.grad</code>å±æ€§ä¸­</li>
<li>ä½¿ç”¨é“¾å¼è§„åˆ™ä¸€ç›´ä¼ æ’­åˆ°å¶å­å¼ é‡</li>
</ul>
<p><strong>DAG åœ¨ PyTorch ä¸­æ˜¯åŠ¨æ€çš„</strong>ã€‚è¦æ³¨æ„çš„é‡è¦ä¸€ç‚¹æ˜¯ï¼Œå›¾æ˜¯ä»å¤´å¼€å§‹é‡æ–°åˆ›å»ºçš„ï¼› åœ¨æ¯ä¸ª<code>.backward()</code>è°ƒç”¨ä¹‹åï¼ŒAutograd å¼€å§‹å¡«å……æ–°å›¾ã€‚ å¯ä»¥æ ¹æ®éœ€è¦åœ¨æ¯æ¬¡è¿­ä»£ä¸­æ›´æ”¹å½¢çŠ¶ï¼Œå¤§å°å’Œæ“ä½œã€‚</p>
<h4 id="ä»dagä¸­æ’é™¤">ä»DAGä¸­æ’é™¤</h4>
<p>å¯¹äºä¸éœ€è¦æ¢¯åº¦çš„å¼ é‡ï¼Œå°†<code>requires_grad</code>å±æ€§è®¾ç½®ä¸º<code>False</code>ä¼šå°†å…¶ä»æ¢¯åº¦è®¡ç®— DAG ä¸­æ’é™¤ã€‚ä½†æ³¨æ„ï¼Œå³ä½¿åªæœ‰ä¸€ä¸ªè¾“å…¥å¼ é‡è¯¥å±æ€§ä¸º<code>True</code>ï¼Œæ“ä½œçš„è¾“å‡ºå¼ é‡ä¹Ÿå°†éœ€è¦æ¢¯åº¦ã€‚</p>
<p>åœ¨ NN ä¸­ï¼Œä¸è®¡ç®—æ¢¯åº¦çš„å‚æ•°é€šå¸¸ç§°ä¸º<strong>å†»ç»“å‚æ•°</strong>ã€‚ å¦‚æœäº‹å…ˆçŸ¥é“æ‚¨ä¸éœ€è¦è¿™äº›å‚æ•°çš„æ¢¯åº¦ï¼Œåˆ™â€œå†»ç»“â€æ¨¡å‹çš„ä¸€éƒ¨åˆ†ä¼šå¸¦æ¥æ€§èƒ½ä¼˜åŠ¿ã€‚å¸¸è§ç”¨ä¾‹ï¼š<strong>è°ƒæ•´é¢„è®­ç»ƒç½‘ç»œ(finetuning)</strong></p>
<p>åœ¨å¾®è°ƒä¸­ï¼Œæˆ‘ä»¬å†»ç»“äº†å¤§éƒ¨åˆ†æ¨¡å‹ï¼Œé€šå¸¸ä»…ä¿®æ”¹åˆ†ç±»å™¨å±‚ä»¥å¯¹æ–°æ ‡ç­¾è¿›è¡Œé¢„æµ‹ã€‚ exï¼šåŠ è½½ä¸€ä¸ªé¢„è®­ç»ƒçš„ resnet18 æ¨¡å‹ï¼Œå¹¶å†»ç»“æ‰€æœ‰å‚æ•°ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> torch <span class="token keyword">import</span> nn<span class="token punctuation">,</span> optim

model <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>models<span class="token punctuation">.</span>resnet18<span class="token punctuation">(</span>pretrained<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># Freeze all the parameters in the network</span>
<span class="token keyword">for</span> param <span class="token keyword">in</span> model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    param<span class="token punctuation">.</span>requires_grad <span class="token operator">=</span> <span class="token boolean">False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å‡è®¾æˆ‘ä»¬è¦åœ¨å…·æœ‰ 10 ä¸ªæ ‡ç­¾çš„æ–°æ•°æ®é›†ä¸­å¾®è°ƒæ¨¡å‹ã€‚ åœ¨ resnet ä¸­ï¼Œåˆ†ç±»å™¨æ˜¯æœ€åä¸€ä¸ªçº¿æ€§å±‚<code>model.fc</code>ã€‚ æˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†å…¶æ›¿æ¢ä¸ºå……å½“æˆ‘ä»¬çš„åˆ†ç±»å™¨çš„æ–°çº¿æ€§å±‚ï¼ˆé»˜è®¤æƒ…å†µä¸‹æœªå†»ç»“ï¼‰ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">model<span class="token punctuation">.</span>fc <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ç°åœ¨ï¼Œé™¤äº†<code>model.fc</code>çš„å‚æ•°å¤–ï¼Œæ¨¡å‹ä¸­çš„æ‰€æœ‰å‚æ•°éƒ½å°†å†»ç»“ã€‚ è®¡ç®—æ¢¯åº¦çš„å”¯ä¸€å‚æ•°æ˜¯<code>model.fc</code>çš„æƒé‡å’Œåå·®ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Optimize only the classifier</span>
optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>fc<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å°½ç®¡æˆ‘ä»¬åœ¨ä¼˜åŒ–å™¨ä¸­æ³¨å†Œäº†æ‰€æœ‰å‚æ•°ï¼Œä½†å”¯ä¸€å¯è®¡ç®—æ¢¯åº¦çš„å‚æ•°ï¼ˆå› æ­¤ä¼šåœ¨æ¢¯åº¦ä¸‹é™ä¸­è¿›è¡Œæ›´æ–°ï¼‰æ˜¯åˆ†ç±»å™¨çš„æƒé‡å’Œåå·®<code>torch.no_grad()</code>ä¸­çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ’é™¤åŠŸèƒ½ã€‚</p>
<h3 id="ç¥ç»ç½‘ç»œ">ç¥ç»ç½‘ç»œ</h3>
<p>å¯ä»¥ä½¿ç”¨<code>torch.nn</code>åŒ…æ„å»ºç¥ç»ç½‘ç»œã€‚<code>nn</code>ä¾èµ–äº<code>autograd</code>æ¥å®šä¹‰æ¨¡å‹å¹¶å¯¹å…¶è¿›è¡Œå¾®åˆ†ã€‚ <code>nn.Module</code>åŒ…å«å±‚ï¼Œä»¥åŠè¿”å›<code>output</code>çš„æ–¹æ³•<code>forward(input)</code>ã€‚</p>
<p>ç¥ç»ç½‘ç»œçš„å…¸å‹è®­ç»ƒè¿‡ç¨‹ï¼š</p>
<ul>
<li>å®šä¹‰å…·æœ‰ä¸€äº›å¯å­¦ä¹ å‚æ•°ï¼ˆæˆ–æƒé‡ï¼‰çš„ç¥ç»ç½‘ç»œ</li>
<li>éå†è¾“å…¥æ•°æ®é›†</li>
<li>é€šè¿‡ç½‘ç»œå¤„ç†è¾“å…¥</li>
<li>è®¡ç®—æŸå¤±ï¼ˆè¾“å‡ºæ­£ç¡®çš„è·ç¦»æœ‰å¤šè¿œï¼‰</li>
<li>å°†æ¢¯åº¦ä¼ æ’­å›ç½‘ç»œå‚æ•°</li>
<li>é€šå¸¸ä½¿ç”¨ç®€å•çš„æ›´æ–°è§„åˆ™æ¥æ›´æ–°ç½‘ç»œçš„æƒé‡ï¼š<code>weight = weight - learning_rate * gradient</code></li>
</ul>
<h4 id="å®šä¹‰ç½‘ç»œ">å®šä¹‰ç½‘ç»œ</h4>
<p>exï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F


<span class="token keyword">class</span> <span class="token class-name">Net</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Net<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 1 input image channel, 6 output channels, 5x5 square convolution</span>
        <span class="token comment"># kernel</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
        <span class="token comment"># an affine operation: y = Wx + b</span>
        self<span class="token punctuation">.</span>fc1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">16</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span>  <span class="token comment"># 5*5 from image dimension</span>
        self<span class="token punctuation">.</span>fc2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fc3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Max pooling over a (2, 2) window</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>max_pool2d<span class="token punctuation">(</span>F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># If the size is a square, you can specify with a single number</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>max_pool2d<span class="token punctuation">(</span>F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> torch<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># flatten all dimensions except the batch dimension</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fc1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fc2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>fc3<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x


net <span class="token operator">=</span> Net<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¾“å‡ºï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">Net<span class="token punctuation">(</span>
  <span class="token punctuation">(</span>conv1<span class="token punctuation">)</span><span class="token punctuation">:</span> Conv2d<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span>conv2<span class="token punctuation">)</span><span class="token punctuation">:</span> Conv2d<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span>fc1<span class="token punctuation">)</span><span class="token punctuation">:</span> Linear<span class="token punctuation">(</span>in_features<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">,</span> out_features<span class="token operator">=</span><span class="token number">120</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span>fc2<span class="token punctuation">)</span><span class="token punctuation">:</span> Linear<span class="token punctuation">(</span>in_features<span class="token operator">=</span><span class="token number">120</span><span class="token punctuation">,</span> out_features<span class="token operator">=</span><span class="token number">84</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span>fc3<span class="token punctuation">)</span><span class="token punctuation">:</span> Linear<span class="token punctuation">(</span>in_features<span class="token operator">=</span><span class="token number">84</span><span class="token punctuation">,</span> out_features<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åªéœ€å®šä¹‰<code>forward</code>å‡½æ•°ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>autograd</code>è‡ªåŠ¨å®šä¹‰<code>backward</code>å‡½æ•°ï¼ˆè®¡ç®—æ¢¯åº¦ï¼‰ã€‚ å¯ä»¥åœ¨<code>forward</code>å‡½æ•°ä¸­ä½¿ç”¨ä»»ä½•å¼ é‡æ“ä½œã€‚</p>
<p>æ¨¡å‹çš„å¯å­¦ä¹ å‚æ•°ç”±<code>net.parameters()</code>è¿”å›ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">params <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>net<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># conv1's .weight</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>è¾“å‡ºï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token number">10</span>
torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å°è¯•ä¸€ä¸ª <code>32*32</code> éšæœºè¾“å…¥ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">input</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>
out <span class="token operator">=</span> net<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>è¾“å‡ºï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0.0818</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0857</span><span class="token punctuation">,</span>  <span class="token number">0.0695</span><span class="token punctuation">,</span>  <span class="token number">0.1430</span><span class="token punctuation">,</span>  <span class="token number">0.0191</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1402</span><span class="token punctuation">,</span>  <span class="token number">0.0499</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0737</span><span class="token punctuation">,</span>
         <span class="token operator">-</span><span class="token number">0.0857</span><span class="token punctuation">,</span>  <span class="token number">0.1395</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> grad_fn<span class="token operator">=</span><span class="token operator">&lt;</span>AddmmBackward0<span class="token operator">&gt;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>ä½¿ç”¨éšæœºæ¢¯åº¦å°†æ‰€æœ‰å‚æ•°å’Œåå‘ä¼ æ’­çš„æ¢¯åº¦ç¼“å†²åŒºå½’é›¶ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">net<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
out<span class="token punctuation">.</span>backward<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>æ³¨æ„ï¼š<code>torch.nn</code>ä»…æ”¯æŒmini-batchã€‚ æ•´ä¸ª<code>torch.nn</code>åŒ…ä»…æ”¯æŒä½œä¸ºå¾®å‹æ ·æœ¬è€Œä¸æ˜¯å•ä¸ªæ ·æœ¬çš„è¾“å…¥ï¼šexï¼š<code>nn.Conv2d</code>å°†é‡‡ç”¨<code>nSamples x nChannels x Height x Width</code>çš„ 4D å¼ é‡ã€‚å¦‚æœæ‚¨åªæœ‰ä¸€ä¸ªæ ·æœ¬ï¼Œåªéœ€ä½¿ç”¨<code>input.unsqueeze(0)</code>æ·»åŠ ä¸€ä¸ªå‡æ‰¹é‡å°ºå¯¸ã€‚</p>
</blockquote>
<p>æ€»ç»“ï¼š</p>
<ul>
<li><code>torch.Tensor</code>-ä¸€ä¸ª<em>å¤šç»´æ•°ç»„</em>ï¼Œæ”¯æŒè¯¸å¦‚<code>backward()</code>çš„è‡ªåŠ¨å¾®åˆ†æ“ä½œã€‚ åŒæ ·ï¼Œä¿æŒç›¸å¯¹äºå¼ é‡çš„æ¢¯åº¦ã€‚</li>
<li><code>nn.Module</code>-ç¥ç»ç½‘ç»œæ¨¡å—ã€‚ <em>å°è£…å‚æ•°</em>çš„ä¾¿æ·æ–¹æ³•ï¼Œå¹¶å¸¦æœ‰å°†å…¶ç§»åŠ¨åˆ° GPUï¼Œå¯¼å‡ºï¼ŒåŠ è½½ç­‰çš„å¸®åŠ©å™¨ã€‚</li>
<li><code>nn.Parameter</code>-ä¸€ç§å¼ é‡ï¼Œå³å°†å…¶åˆ†é…ä¸º<code>Module</code>çš„å±æ€§æ—¶ï¼Œè‡ªåŠ¨æ³¨å†Œä¸ºå‚æ•°ã€‚</li>
<li><code>autograd.Function</code>-å®ç°è‡ªåŠ¨å¾®åˆ†æ“ä½œçš„æ­£å‘å’Œåå‘å®šä¹‰ã€‚ æ¯ä¸ª<code>Tensor</code>æ“ä½œéƒ½ä¼šåˆ›å»ºè‡³å°‘ä¸€ä¸ª<code>Function</code>èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹è¿æ¥åˆ°åˆ›å»º<code>Tensor</code>çš„å‡½æ•°ï¼Œå¹¶ä¸”ç¼–ç å…¶å†å²è®°å½•ã€‚</li>
</ul>
<h4 id="æŸå¤±å‡½æ•°">æŸå¤±å‡½æ•°</h4>
<p>æŸå¤±å‡½æ•°é‡‡ç”¨ä¸€å¯¹ï¼ˆè¾“å‡ºï¼Œç›®æ ‡ï¼‰è¾“å…¥ï¼Œå¹¶è®¡ç®—ä¸€ä¸ªå€¼ï¼Œè¯¥å€¼ä¼°è®¡è¾“å‡ºä¸ç›®æ ‡ä¹‹é—´çš„è·ç¦»ã€‚</p>
<p><code>nn</code>åŒ…ä¸‹æœ‰å‡ ç§ä¸åŒçš„<a target="_blank" rel="noopener" href="https://pytorch.org/docs/nn.html#loss-functions">æŸå¤±å‡½æ•°</a>ï¼Œä¸€ä¸ªç®€å•çš„æŸå¤±æ˜¯ï¼š<code>nn.MSELoss</code>ï¼Œå®ƒè®¡ç®—è¾“å…¥å’Œç›®æ ‡ä¹‹é—´çš„å‡æ–¹è¯¯å·®ï¼Œexï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">output <span class="token operator">=</span> net<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span>
target <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment"># a dummy target, for example</span>
target <span class="token operator">=</span> target<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># make it the same shape as output</span>
criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>MSELoss<span class="token punctuation">(</span><span class="token punctuation">)</span>

loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>output<span class="token punctuation">,</span> target<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>loss<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¾“å‡ºï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">tensor<span class="token punctuation">(</span><span class="token number">1.1649</span><span class="token punctuation">,</span> grad_fn<span class="token operator">=</span><span class="token operator">&lt;</span>MseLossBackward0<span class="token operator">&gt;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ç°åœ¨ï¼Œå¦‚æœä½¿ç”¨<code>.grad_fn</code>å±æ€§å‘åè·Ÿéš<code>loss</code>ï¼Œæ‚¨å°†çœ‹åˆ°ä¸€ä¸ªè®¡ç®—å›¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">input</span> <span class="token operator">-</span><span class="token operator">&gt;</span> conv2d <span class="token operator">-</span><span class="token operator">&gt;</span> relu <span class="token operator">-</span><span class="token operator">&gt;</span> maxpool2d <span class="token operator">-</span><span class="token operator">&gt;</span> conv2d <span class="token operator">-</span><span class="token operator">&gt;</span> relu <span class="token operator">-</span><span class="token operator">&gt;</span> maxpool2d
      <span class="token operator">-</span><span class="token operator">&gt;</span> view <span class="token operator">-</span><span class="token operator">&gt;</span> linear <span class="token operator">-</span><span class="token operator">&gt;</span> relu <span class="token operator">-</span><span class="token operator">&gt;</span> linear <span class="token operator">-</span><span class="token operator">&gt;</span> relu <span class="token operator">-</span><span class="token operator">&gt;</span> linear
      <span class="token operator">-</span><span class="token operator">&gt;</span> MSELoss
      <span class="token operator">-</span><span class="token operator">&gt;</span> loss<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>å½“æˆ‘ä»¬è°ƒç”¨<code>loss.backward()</code>æ—¶ï¼Œæ•´ä¸ªå›¾å°†è¢«å¾®åˆ†ã€‚ å¹¶ä¸”å›¾ä¸­å…·æœ‰<code>requires_grad=True</code>çš„æ‰€æœ‰å¼ é‡å°†éšæ¢¯åº¦ç´¯ç§¯å…¶<code>.grad</code>å¼ é‡ã€‚</p>
<p>ä¸ºäº†è¯´æ˜ï¼Œè®©æˆ‘ä»¬å‘åèµ°å‡ æ­¥ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>loss<span class="token punctuation">.</span>grad_fn<span class="token punctuation">)</span>  <span class="token comment"># MSELoss</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>loss<span class="token punctuation">.</span>grad_fn<span class="token punctuation">.</span>next_functions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># Linear</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>loss<span class="token punctuation">.</span>grad_fn<span class="token punctuation">.</span>next_functions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>next_functions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># ReLU</span>

<span class="token comment"># è¾“å‡º</span>
<span class="token operator">&lt;</span>MseLossBackward0 <span class="token builtin">object</span> at <span class="token number">0x7f71283dd048</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>AddmmBackward0 <span class="token builtin">object</span> at <span class="token number">0x7f71283dd7f0</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>AccumulateGrad <span class="token builtin">object</span> at <span class="token number">0x7f71283dd7f0</span><span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="åå‘ä¼ æ’­">åå‘ä¼ æ’­</h4>
<p>è¦åå‘ä¼ æ’­è¯¯å·®ï¼Œæˆ‘ä»¬è¦åšçš„åªæ˜¯<code>loss.backward()</code>ã€‚ ä¸è¿‡ï¼Œéœ€è¦æ¸…é™¤ç°æœ‰çš„æ¢¯åº¦ï¼Œå¦åˆ™æ¢¯åº¦å°†ç´¯ç§¯åˆ°ç°æœ‰çš„æ¢¯åº¦ä¸­ã€‚</p>
<p>exï¼šçœ‹ä¸€ä¸‹<code>backward</code>å‰å<code>conv1</code>çš„åå·®æ¢¯åº¦</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">net<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token comment"># zeroes the gradient buffers of all parameters</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'conv1.bias.grad before backward'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">.</span>conv1<span class="token punctuation">.</span>bias<span class="token punctuation">.</span>grad<span class="token punctuation">)</span>

loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'conv1.bias.grad after backward'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">.</span>conv1<span class="token punctuation">.</span>bias<span class="token punctuation">.</span>grad<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¾“å‡ºï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">conv1<span class="token punctuation">.</span>bias<span class="token punctuation">.</span>grad before backward
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
conv1<span class="token punctuation">.</span>bias<span class="token punctuation">.</span>grad after backward
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token number">0.0188</span><span class="token punctuation">,</span>  <span class="token number">0.0172</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0044</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0141</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0058</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0013</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="æ›´æ–°æƒé‡">æ›´æ–°æƒé‡</h4>
<p>å®è·µä¸­ä½¿ç”¨çš„æœ€ç®€å•çš„æ›´æ–°è§„åˆ™æ˜¯éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆSGDï¼‰ï¼š</p>
<p><code>weight = weight - learning_rate * gradient</code></p>
<p>ä½¿ç”¨ç¥ç»ç½‘ç»œæ—¶ï¼Œæ‚¨å¸Œæœ›ä½¿ç”¨å„ç§ä¸åŒçš„æ›´æ–°è§„åˆ™ï¼Œä¾‹å¦‚ SGDï¼ŒNesterov-SGDï¼ŒAdamï¼ŒRMSProp ç­‰ã€‚ä¸ºå®ç°æ­¤ç›®çš„ï¼Œ<code>torch.optim</code>å¯å®ç°æ‰€æœ‰è¿™äº›æ–¹æ³•ã€‚ ä½¿ç”¨å®ƒéå¸¸ç®€å•ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">as</span> optim

<span class="token comment"># create your optimizer</span>
optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>net<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span>

<span class="token comment"># in your training loop:</span>
optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment"># zero the gradient buffers</span>
output <span class="token operator">=</span> net<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span>
loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>output<span class="token punctuation">,</span> target<span class="token punctuation">)</span>
loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># Does the update</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>æ³¨æ„ï¼šä½¿ç”¨<code>optimizer.zero_grad()</code>å°†æ¢¯åº¦ç¼“å†²åŒºæ‰‹åŠ¨è®¾ç½®ä¸ºé›¶ã€‚ è¿™æ˜¯å› ä¸ºå¦‚åå‘ä¼ æ’­éƒ¨åˆ†ä¸­æ‰€è¿°ç´¯ç§¯äº†æ¢¯åº¦ã€‚</p>
</blockquote>
<h3 id="è®­ç»ƒåˆ†ç±»å™¨">è®­ç»ƒåˆ†ç±»å™¨</h3>
<h4 id="æ•°æ®">æ•°æ®</h4>
<p>å¤„ç†å›¾åƒï¼Œæ–‡æœ¬ï¼ŒéŸ³é¢‘æˆ–è§†é¢‘æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å°†æ•°æ®åŠ è½½åˆ° NumPy æ•°ç»„ä¸­çš„æ ‡å‡† Python åŒ…ã€‚ ç„¶åï¼Œæ‚¨å¯ä»¥å°†è¯¥æ•°ç»„è½¬æ¢ä¸º<code>torch.*Tensor</code>ã€‚</p>
<ul>
<li>å¯¹äºå›¾åƒï¼ŒPillowï¼ŒOpenCV ç­‰åŒ…å¾ˆæœ‰ç”¨</li>
<li>å¯¹äºéŸ³é¢‘ï¼Œè¯·ä½¿ç”¨ SciPy å’Œ librosa ç­‰åŒ…</li>
<li>å¯¹äºæ–‡æœ¬ï¼ŒåŸºäº Python æˆ– Cython çš„åŸå§‹åŠ è½½ï¼Œæˆ–è€… NLTK å’Œ SpaCy å¾ˆæœ‰ç”¨</li>
</ul>
<p>ä¸“é—¨é’ˆå¯¹è§†è§‰çš„<code>torchvision</code>åŒ…ï¼Œå…¶ä¸­åŒ…å«ç”¨äºå¸¸è§æ•°æ®é›†ï¼ˆä¾‹å¦‚ Imagenetï¼ŒCIFAR10ï¼ŒMNIST ç­‰ï¼‰çš„æ•°æ®åŠ è½½å™¨ï¼Œä»¥åŠç”¨äºå›¾åƒï¼ˆå³<code>torchvision.datasets</code>å’Œ<code>torch.utils.data.DataLoader</code>ï¼‰çš„æ•°æ®è½¬æ¢å™¨ã€‚</p>
<pre><code>#### è®­ç»ƒ
</code></pre>
<p>exï¼šå°†ä½¿ç”¨ CIFAR10 æ•°æ®é›†ã€‚ å®ƒå…·æœ‰ä»¥ä¸‹ç±»åˆ«ï¼šâ€œé£æœºâ€ï¼Œâ€œæ±½è½¦â€ï¼Œâ€œé¸Ÿâ€ï¼Œâ€œçŒ«â€ï¼Œâ€œé¹¿â€ï¼Œâ€œç‹—â€ï¼Œâ€œé’è›™â€ï¼Œâ€œé©¬â€ï¼Œâ€œèˆ¹â€ï¼Œâ€œå¡è½¦â€ã€‚ CIFAR-10 ä¸­çš„å›¾åƒå°ºå¯¸ä¸º<code>3x32x32</code>ï¼Œå³å°ºå¯¸ä¸º<code>32x32</code>åƒç´ çš„ 3 é€šé“å½©è‰²å›¾åƒã€‚</p>
<p>åº”æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>ä½¿ç”¨<code>torchvision</code>åŠ è½½å¹¶æ ‡å‡†åŒ– CIFAR10 è®­ç»ƒå’Œæµ‹è¯•æ•°æ®é›†</li>
<li>å®šä¹‰å·ç§¯ç¥ç»ç½‘ç»œ</li>
<li>å®šä¹‰æŸå¤±å‡½æ•°</li>
<li>æ ¹æ®è®­ç»ƒæ•°æ®è®­ç»ƒç½‘ç»œ</li>
<li>åœ¨æµ‹è¯•æ•°æ®ä¸Šæµ‹è¯•ç½‘ç»œ</li>
</ol>
<p>1.<strong>åŠ è½½å¹¶æ ‡å‡†åŒ– CIFAR10</strong></p>
<p>TorchVision æ•°æ®é›†çš„è¾“å‡ºæ˜¯<code>[0, 1]</code>èŒƒå›´çš„<code>PILImage</code>å›¾åƒã€‚ æˆ‘ä»¬å°†å®ƒä»¬è½¬æ¢ä¸ºå½’ä¸€åŒ–èŒƒå›´<code>[-1, 1]</code>çš„å¼ é‡</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torchvision
<span class="token keyword">import</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">as</span> transforms

transform <span class="token operator">=</span> transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     transforms<span class="token punctuation">.</span>Normalize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

trainset <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>CIFAR10<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">'./data'</span><span class="token punctuation">,</span> train<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                                        download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> transform<span class="token operator">=</span>transform<span class="token punctuation">)</span>
trainloader <span class="token operator">=</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>trainset<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>
                                          shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> num_workers<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

testset <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>CIFAR10<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">'./data'</span><span class="token punctuation">,</span> train<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                                       download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> transform<span class="token operator">=</span>transform<span class="token punctuation">)</span>
testloader <span class="token operator">=</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>testset<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>
                                         shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> num_workers<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

classes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'plane'</span><span class="token punctuation">,</span> <span class="token string">'car'</span><span class="token punctuation">,</span> <span class="token string">'bird'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">,</span>
           <span class="token string">'deer'</span><span class="token punctuation">,</span> <span class="token string">'dog'</span><span class="token punctuation">,</span> <span class="token string">'frog'</span><span class="token punctuation">,</span> <span class="token string">'horse'</span><span class="token punctuation">,</span> <span class="token string">'ship'</span><span class="token punctuation">,</span> <span class="token string">'truck'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å±•ç¤ºä¸€äº›è®­ç»ƒå›¾åƒ</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token comment"># functions to show an image</span>

<span class="token keyword">def</span> <span class="token function">imshow</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span>
    img <span class="token operator">=</span> img <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">0.5</span>     <span class="token comment"># unnormalize</span>
    npimg <span class="token operator">=</span> img<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>np<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>npimg<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># get some random training images</span>
dataiter <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>trainloader<span class="token punctuation">)</span>
images<span class="token punctuation">,</span> labels <span class="token operator">=</span> dataiter<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># show images</span>
imshow<span class="token punctuation">(</span>torchvision<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>make_grid<span class="token punctuation">(</span>images<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># print labels</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'%5s'</span> <span class="token operator">%</span> classes<span class="token punctuation">[</span>labels<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2.<strong>å®šä¹‰å·ç§¯ç¥ç»ç½‘ç»œ</strong></p>
<p>ä¹‹å‰ä»â€œç¥ç»ç½‘ç»œâ€éƒ¨åˆ†å¤åˆ¶ç¥ç»ç½‘ç»œï¼Œç„¶åå¯¹å…¶è¿›è¡Œä¿®æ”¹ä»¥è·å– 3 é€šé“å›¾åƒï¼ˆè€Œä¸æ˜¯å®šä¹‰çš„ 1 é€šé“å›¾åƒï¼‰ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F

<span class="token keyword">class</span> <span class="token class-name">Net</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Net<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pool <span class="token operator">=</span> nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fc1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">16</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fc2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fc3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>pool<span class="token punctuation">(</span>F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>pool<span class="token punctuation">(</span>F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> x<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">16</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fc1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fc2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>fc3<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x

net <span class="token operator">=</span> Net<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.<strong>å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨</strong></p>
<p>ä½¿ç”¨åˆ†ç±»äº¤å‰ç†µæŸå¤±å’Œå¸¦åŠ¨é‡çš„ SGD</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">as</span> optim

criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>net<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>4.<strong>è®­ç»ƒç½‘ç»œ</strong></p>
<p>åªéœ€éå†æ•°æ®è¿­ä»£å™¨ï¼Œç„¶åå°†è¾“å…¥é¦ˆé€åˆ°ç½‘ç»œå¹¶è¿›è¡Œä¼˜åŒ–å³å¯ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># loop over the dataset multiple times</span>

    running_loss <span class="token operator">=</span> <span class="token number">0.0</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> data <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>trainloader<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># get the inputs; data is a list of [inputs, labels]</span>
        inputs<span class="token punctuation">,</span> labels <span class="token operator">=</span> data

        <span class="token comment"># zero the parameter gradients</span>
        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># forward + backward + optimize</span>
        outputs <span class="token operator">=</span> net<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span>
        loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> labels<span class="token punctuation">)</span>
        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># print statistics</span>
        running_loss <span class="token operator">+=</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">2000</span> <span class="token operator">==</span> <span class="token number">1999</span><span class="token punctuation">:</span>    <span class="token comment"># print every 2000 mini-batches</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[%d, %5d] loss: %.3f'</span> <span class="token operator">%</span>
                  <span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> running_loss <span class="token operator">/</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            running_loss <span class="token operator">=</span> <span class="token number">0.0</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Finished Training'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¿«é€Ÿä¿å­˜æˆ‘ä»¬è®­ç»ƒè¿‡çš„æ¨¡å‹ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">PATH <span class="token operator">=</span> <span class="token string">'./cifar_net.pth'</span>
torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>net<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> PATH<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>5.<strong>æ ¹æ®æµ‹è¯•æ•°æ®æµ‹è¯•ç½‘ç»œ</strong></p>
<p>æˆ‘ä»¬å·²ç»åœ¨è®­ç»ƒæ•°æ®é›†ä¸­å¯¹ç½‘ç»œè¿›è¡Œäº† 2 æ¬¡è®­ç»ƒï¼Œä¸‹é¢å°†é€šè¿‡é¢„æµ‹ç¥ç»ç½‘ç»œè¾“å‡ºçš„ç±»åˆ«æ ‡ç­¾å¹¶æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œæ£€æŸ¥æ¥è¿›è¡Œæ£€æŸ¥ã€‚ å¦‚æœé¢„æµ‹æ­£ç¡®ï¼Œåˆ™å°†æ ·æœ¬æ·»åŠ åˆ°æ­£ç¡®é¢„æµ‹åˆ—è¡¨ä¸­ã€‚</p>
<p>æ˜¾ç¤ºæµ‹è¯•é›†ä¸­çš„å‡ å¼ å›¾åƒ</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">dataiter <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>testloader<span class="token punctuation">)</span>
images<span class="token punctuation">,</span> labels <span class="token operator">=</span> dataiter<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># print images</span>
imshow<span class="token punctuation">(</span>torchvision<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>make_grid<span class="token punctuation">(</span>images<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'GroundTruth: '</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'%5s'</span> <span class="token operator">%</span> classes<span class="token punctuation">[</span>labels<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é‡æ–°åŠ è½½ä¿å­˜çš„æ¨¡å‹ï¼ˆè¿™é‡Œä¸éœ€è¦ä¿å­˜å’Œé‡æ–°åŠ è½½æ¨¡å‹ï¼Œåªæ˜¯ä¸ºäº†è¯´æ˜å¦‚ä½•è¿™æ ·åšï¼‰ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">net <span class="token operator">=</span> Net<span class="token punctuation">(</span><span class="token punctuation">)</span>
net<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span>PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>ç¥ç»ç½‘ç»œå¯¹ä»¥ä¸Šç¤ºä¾‹çš„çœ‹æ³•ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">outputs <span class="token operator">=</span> net<span class="token punctuation">(</span>images<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è¾“å‡º10ç±»çš„èƒ½é‡ï¼Œ ä¸€ä¸ªç±»åˆ«çš„èƒ½é‡è¶Šé«˜ï¼Œç½‘ç»œå°±è®¤ä¸ºè¯¥å›¾åƒå±äºç‰¹å®šç±»åˆ«ã€‚ å› æ­¤è®©æˆ‘ä»¬è·å–æœ€é«˜èƒ½é‡çš„æŒ‡æ•°ï¼Œæ‰“å°ç¤ºä¾‹çš„æµ‹è¯•ç»“æœï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">_<span class="token punctuation">,</span> predicted <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Predicted: '</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'%5s'</span> <span class="token operator">%</span> classes<span class="token punctuation">[</span>predicted<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span>
                              <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç½‘ç»œåœ¨æ•´ä¸ªæ•°æ®é›†ä¸Šçš„è¡¨ç°ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">correct <span class="token operator">=</span> <span class="token number">0</span>
total <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> data <span class="token keyword">in</span> testloader<span class="token punctuation">:</span>
        images<span class="token punctuation">,</span> labels <span class="token operator">=</span> data
        outputs <span class="token operator">=</span> net<span class="token punctuation">(</span>images<span class="token punctuation">)</span>
        _<span class="token punctuation">,</span> predicted <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>outputs<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        total <span class="token operator">+=</span> labels<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        correct <span class="token operator">+=</span> <span class="token punctuation">(</span>predicted <span class="token operator">==</span> labels<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Accuracy of the network on the 10000 test images: %d %%'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>
    <span class="token number">100</span> <span class="token operator">*</span> correct <span class="token operator">/</span> total<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å“ªäº›ç±»çš„è¡¨ç°è‰¯å¥½ï¼Œå“ªäº›ç±»çš„è¡¨ç°ä¸ä½³ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">class_correct <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
class_total <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> data <span class="token keyword">in</span> testloader<span class="token punctuation">:</span>
        images<span class="token punctuation">,</span> labels <span class="token operator">=</span> data
        outputs <span class="token operator">=</span> net<span class="token punctuation">(</span>images<span class="token punctuation">)</span>
        _<span class="token punctuation">,</span> predicted <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        c <span class="token operator">=</span> <span class="token punctuation">(</span>predicted <span class="token operator">==</span> labels<span class="token punctuation">)</span><span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            label <span class="token operator">=</span> labels<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            class_correct<span class="token punctuation">[</span>label<span class="token punctuation">]</span> <span class="token operator">+=</span> c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
            class_total<span class="token punctuation">[</span>label<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Accuracy of %5s : %2d %%'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>
        classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">100</span> <span class="token operator">*</span> class_correct<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/</span> class_total<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="gpu">GPU</h4>
<p>å°†ç¥ç»ç½‘ç»œè½¬ç§»åˆ°GPUä¸Š</p>
<p>é¦–å…ˆå°†æˆ‘ä»¬çš„è®¾å¤‡å®šä¹‰ä¸ºç¬¬ä¸€ä¸ªå¯è§çš„ cuda è®¾å¤‡ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cuda:0"</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"cpu"</span><span class="token punctuation">)</span>

<span class="token comment"># Assuming that we are on a CUDA machine, this should print a CUDA device:</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>device<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™äº›æ–¹æ³•å°†é€’å½’éå†æ‰€æœ‰æ¨¡å—ï¼Œå¹¶å°†å…¶å‚æ•°å’Œç¼“å†²åŒºè½¬æ¢ä¸º CUDA å¼ é‡ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">net<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è¿˜å¿…é¡»å°†æ¯ä¸€æ­¥çš„è¾“å…¥å’Œç›®æ ‡ä¹Ÿå‘é€åˆ° GPUï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">inputs<span class="token punctuation">,</span> labels <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="sb">sb</h3>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/note/" rel="tag"># note</a>
              <a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" rel="tag"># æ·±åº¦å­¦ä¹ </a>
              <a href="/tags/python/" rel="tag"># python</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/post/dl/base/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0_%E5%9F%BA%E6%9C%AC%E7%90%86%E8%AE%BA.html" rel="prev" title="æ·±åº¦å­¦ä¹ ï¼šåŸºæœ¬ç†è®º">
      <i class="fa fa-chevron-left"></i> æ·±åº¦å­¦ä¹ ï¼šåŸºæœ¬ç†è®º
    </a></div>
      <div class="post-nav-item">
    <a href="/post/dl/cnn/AlexNet.html" rel="next" title="CNNç»å…¸ç½‘ç»œï¼šAlexNet">
      CNNç»å…¸ç½‘ç»œï¼šAlexNet <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-text">åŸºç¡€çŸ¥è¯†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%A0%E9%87%8F"><span class="nav-text">å¼ é‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#autograd"><span class="nav-text">Autograd</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C"><span class="nav-text">ç¥ç»ç½‘ç»œ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%AD%E7%BB%83%E5%88%86%E7%B1%BB%E5%99%A8"><span class="nav-text">è®­ç»ƒåˆ†ç±»å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sb"><span class="nav-text">sb</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Maskros"
      src="/img/logo_Maskros.jpg">
  <p class="site-author-name" itemprop="name">Maskros</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">62</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">53</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Maskros-new" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;Maskros-new" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:haohangjian2002@gmail.com" title="E-Mail â†’ mailto:haohangjian2002@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/355516889" title="Bilibili â†’ https:&#x2F;&#x2F;space.bilibili.com&#x2F;355516889" rel="noopener" target="_blank"><i class="fas fa-tv fa-fw"></i>Bilibili</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://codeforces.com/profile/1ronMaker" title="Codeforces1 â†’ https:&#x2F;&#x2F;codeforces.com&#x2F;profile&#x2F;1ronMaker" rel="noopener" target="_blank"><i class="far fa-chart-bar fa-fw"></i>Codeforces1</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://codeforces.com/profile/7hhnewbee" title="Codeforces2 â†’ https:&#x2F;&#x2F;codeforces.com&#x2F;profile&#x2F;7hhnewbee" rel="noopener" target="_blank"><i class="far fa-chart-bar fa-fw"></i>Codeforces2</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.cnblogs.com/lipoicyclic/" title="https:&#x2F;&#x2F;www.cnblogs.com&#x2F;lipoicyclic&#x2F;" rel="noopener" target="_blank">è„‚ç¯</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://coinc1dens.me/" title="https:&#x2F;&#x2F;coinc1dens.me&#x2F;" rel="noopener" target="_blank">x1</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://rayjinx.com/" title="https:&#x2F;&#x2F;rayjinx.com&#x2F;" rel="noopener" target="_blank">æ —æ‚Ÿé¥­</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://nerdzzh.me/" title="https:&#x2F;&#x2F;nerdzzh.me&#x2F;" rel="noopener" target="_blank">edicius</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://zwh-sdu.github.io/" title="https:&#x2F;&#x2F;zwh-sdu.github.io&#x2F;" rel="noopener" target="_blank">zwh</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Maskros</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'Nmc1pCkN608WUnjzl1OVUJwp-gzGzoHsz',
      appKey     : 'AgMMODlKtVQJ8D2ksYM7tqFv',
      placeholder: "Leave your thoughts behind~",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
